% Credit: TeXniCie A-eskwadraat
%
%%% This is a subfile! Type your chapters/section, appendices, etc in here! This code can be run by itself to try for bugs or typo's, but you have to declare your master file for this to work.

% Declare the documentclass. Don't change \documentclass[...]{subfiles}, but replace the ... with the name of your master file.
\documentclass[thesis]{subfiles}

% Write the body of the chapter/section/other. You CAN NOT define preamble stuff in here (like \newcommand or \usepackage), that should be done in the preamble.tex instead (which will automatically apply to all subfiles).
\begin{document}

\newpage

\section{Structure in a fluid}

A thermodynamic system is in a fluid phase when it is homogeneous and isotropic averaged over time, i.e. when there is no order in the system. At any moment in time, however, a fluid does have local structure. For example in a system of hard cubes, by simple chance we should find a small cluster of cubes which are more or less aligned with each other. These clusters appear and disappear at low pressure. At high enough pressures, neighbouring cubes simply ``push" these clusters together, as it is more space-efficient for cubes to be aligned. In free energy terms, at high density it is entropically favourable for the system to be in a crystal phase, because there are more configurations where the cubes are aligned than where they are randomly oriented\todo{maybe this part is too tangential}. This can be seen by considering the excluded volume of two cubes: A hard cube's existence blocks a volume---the \emph{excluded volume}---where other cubes can be. If we want more possible configurations, having the excluded volume of two cubes overlap makes more total space available, since doubly excluded volume does not make doubly less space for other cubes.

Because we want to study crystallization, i.e. structure formation in a fluid, we should study the local structure fluctuations in the fluid. This is what will be done in this section.

\subsection{Radial distribution function}

A simple way to look at the structure of a colloidal system is to look at the \emph{radial distribution function}, closely related to the \emph{pair correlation function}. We discuss the latter first, because it is more general. Loosely speaking, the pair correlation function $\rho^{(2)}(\bm r, \bm r')$ is the probability that there is a particle at position $\bm r$ and $\bm r'$ at the same time. In a formula, this looks like 
\begin{equation}
	\rho^{(2)}(\bm r, \bm r') = \llangle \sum_i \sum_{j \neq i} \delta(\bm r - \bm r_i) \delta(\bm r' - \bm r_j) \rrangle.
\end{equation}
where $\langle \cdot \rangle$ denotes the ensemble average, $\bm r_i$ is the position of particle $i$, and the sums are over all pairs of particles (where a pair cannot be the same two).
If our system is homogeneous, we can arbitrarily pick one of the particles to be at the origin, and if our system is also isotropic, orientation does not matter either, and the only parameter left is distance. These simplifications lead to the radial distribution function $g(r):$
\begin{equation}
	\rho^{(2)}(\bm r, \bm r') = \rho^2 g(|\bm r - \bm r'|),
\end{equation}
where the density $\rho$ of particles in the system has been factored out. This is done so $g(r) \rightarrow 1$ as $r \rightarrow \infty$, so long as there is no long range order (e.g. in a liquid). A few typical examples of radial distribution functions, henceforth simply called $g(r)$, are:


\begin{itemize}
	\item Ideal gas: $g(r) \equiv 1$.\\
	Since there is no interaction between particles in an ideal gas, there is no correlation between one particle position and another.
\begin{comment}
	\item Dilute gas of hard spheres of diameter $\sigma$: $g(r) = \begin{cases} 0 & \textrm{if } r < \sigma, \\ 1 & \textrm{else.} \end{cases}$\\
	Since hard spheres cannot overlap, we won't find any within one diameter of another (hence the $g(r)$ is zero there). But because the gas is dilute, there is very little interaction, and it'll be equally likely to find a sphere anywhere else.
\end{comment}
	\item Perfect one dimensional crystal with lattice constant $\sigma$: $g(x) = \sum_{i = 1}^\infty \delta(x - i\sigma)$, where $\delta(x)$ is the Dirac-$\delta$ function.\\
	In a perfect crystal, all particle positions are static. In this particular crystal, each particle sees two particles at exactly an integer amount times $\sigma$ away. This manifests itself in the $g(r)$ by becoming $\delta$-peaks.
\end{itemize}

With some imagination, after looking at the last example, one can see how on a 2-dimensional square lattice, we would also see peaks at distances of $\sqrt 2\sigma, \sqrt 5\sigma$, and other distances between square lattice sites. With even more imagination, one can see that the more relevant 3-dimensional cubic crystal would also give peaks at $\sqrt 3 \sigma, \sqrt 6 \sigma$ and other distances between cubic lattice sites.
If the particles were allowed to move a little bit (say e.g. due to heat), the $\delta$-peaks would broaden. This is what we will see in the next bit.
\bigbreak
Before we look at the $g(r)$ of our system, let's motivate why. In order to determine the degree of crystallinity in our system, we look at \emph{local} order in our system (be it translational or orientational). In order to determine \emph{how} local we need to look, we can consult the $g(r)$. If we want to only look at the nearest neighbours, we can infer from the $g(r)$ where the first neighbour shell (roughly) ends. This way we can choose the cutoff for neighbouring particles less arbitrarily.

%\newpage
\subsection{Measurements of \texorpdfstring{$g(r)$}{g(r)}}

So let's take a look at the $g(r)$ of a typical system we are studying: hard cubes in an $NpT$ simulation with periodic boundary conditions. We look at a high pressure (resulting in a crystal), and a low pressure (resulting in a liquid state). In either case, there are no cubes within a distance of 1, as this is not allowed.

\begin{figure}[H]
	\centering
	\begin{subfigure}{0.3\textwidth}
		\centering
		\includegraphics[width=0.815\linewidth]{images/gofr_90_X_snapshot}
		\caption{A snapshot of the system. $\rho = 0.644$.}
	\end{subfigure}
	\begin{subfigure}{0.5\textwidth}
		\centering
		\includegraphics[width=\linewidth]{images/gofr_90_X}
		\caption{The $g(r)$ averaged over numerous Monte Carlo steps.}
		\label{fig:gofr_crystal_b}
	\end{subfigure}
	\caption{A crystal of cubes with side length 1. On the left is a typical snapshot of the system. On the right the $g(r)$, averaged over many \todo[inline]{is \emph{many} too vague? or is it unimportant?} snapshots is plotted. There is a sharp peak at roughly 1.1, and at roughly $1.1 \sqrt 2 \approx 1.55$ is a peak where we expect the second-nearest neighbours. A small bump at $1.1 \sqrt 3 \approx 1.9$ is also visible, which corresponds to the third-nearest neighbours. The first minimum at roughly 1.4 is also marked, signifying where we should put our cutoff for the nearest neighbours.}
\end{figure}

\begin{figure}[H]
	\centering
	\vspace{-8pt}
\begin{subfigure}{0.3\textwidth}
	\centering
	\vspace{8pt}
	\includegraphics[width=0.815\linewidth]{images/gofr_90_l_snapshot}
	\vspace{10pt}
	\caption{A snapshot of the system. $\rho = 0.413$.}
\end{subfigure}
\begin{subfigure}{0.5\textwidth}
	\centering
	\includegraphics[width=\linewidth]{images/gofr_90_l}
	\caption{The $g(r)$ averaged over numerous Monte Carlo steps.}
\end{subfigure}
\caption{A disordered liquid of cubes with side length 1. On the left is a typical snapshot of the system. On the right, the $g(r)$, averaged over many snapshots is plotted. We don't see a cubic crystal structure (we'd expect peaks at $1, \sqrt 2, \sqrt 3$ times the lattice spacing), but rather, we see \emph{neighbour shells}, as is typical of a fluid. We see a peak at roughly 1.2, which corresponds to the first neighbour shell. At a distance of 2.05 the minimum between the first two neighbour shells is marked.}
\end{figure}
From figure \ref{fig:gofr_crystal_b}, we infer that at a density of approximately 0.644, most first neighbours are within a distance of 1.4 edge lengths. A simple calculation shows \todo{maybe show this? it doesn't fit nicely on the page} that the lattice spacing of a crystal is proportional to $\rho^{-1/3}$. So, at a density of 0.45 (close to the transition between fluid and crystal for cubes \cite{van2017phase}), most first neighbours are within $1.4 \left( \frac{0.45}{0.644}\right)^{-1/3} \approx 1.58$ edge lengths. 

\subsection{Order parameter}
Now we have determined the distance to the closest neighbours in a crystal, we call two cubes \emph{neighbouring} or \emph{bonded} if they are within a distance of 1.55 edge lengths of each other\todo{is this a good idea/good way to word it?}\footnote{This was the preliminary value used, and since it's close enough to 1.58 (and the density should increase as a crystal forms, causing this 1.58 to decrease and come closer to 1.55), we stick to it}. Now that we know which cubes are neighbours, we need a rigorous way of distinguishing between crystalline and fluid cubes. Fortunately, there is already a lot of work done before on this subject \cite{steinhardt1983bond, lechner2008accurate, van2017phase, sharma2018disorder, mickel2013shortcomings}. Because we consider cubes rather than spheres, our particles also have an orientation. Therefore, we shall consider two kinds of order: \emph{translational} and \emph{orientational}. The first takes into account only positions relative to each other (and is therefore called \emph{bond-orientational order} \cite{steinhardt1983bond}), and the latter one only considers the orientation of cubes. For translational order we will use the Steinhardt translational order parameter \cite{steinhardt1983bond} $q_4$, and for orientational order we use a slightly modified version we call $i_4$, just like in \cite{sharma2018disorder}. We choose the $\ell = 4$, because it is the smallest $\ell$ that still captures simple cubic order (see \cite{mickel2013shortcomings}, Table 1). Higher order would become more computationally expensive, and more sensitive to small changes in position.\todo{[citation needed]?}

\subsubsection{Translational order parameter \texorpdfstring{$q_4$}{q4}}
In essence what this order parameter does, is doing an expansion of relative position in spherical harmonics. Following \cite{sharma2018disorder}, in general, for a nonnegative integer $\ell$ and integers $ -\ell \leq m \leq\ell$, we define, for cube $i$, the \emph{local translational order parameter}
\begin{equation}
	q_{\ell, m}(i) \coloneqq \sum_{j} Y_{\ell, m} (\theta_{i, j}, \phi_{i, j}),
\end{equation}
where the sum is over all neighbours of cube $i$, $\theta_{i, j}$ and $\phi_{i, j}$ are, respectively, the polar angle and the azimuthal angle of the vector from cube $i$'s centre to cube $j$'s centre. $Y_{\ell, m}$ are the spherical harmonics given by
\begin{equation}
	Y_{\ell, m}(\theta, \phi) \coloneqq \sqrt{\frac{2\ell + 1}{4\pi}\frac{(\ell + m)}{(\ell - m)!}}\ P_\ell^m(\cos(\theta)) \ \me^{im\phi},
\end{equation}
where $P_\ell^m(\cos(\theta))$ are the associated Legendre polynomials. \todo{find nice reference, define associated Legendre polynomial, maybe put this in seperate subsubsection on spherical harmonics.}

Now we have defined the local translation order, we define the translational correlation between neighbouring cubes $i$ and $j$ by taking the dot product and normalizing:
\begin{equation}
	d_{q_\ell}(i, j) \coloneqq \frac{\sum_{m = -\ell}^\ell q_{\ell, m}(i) \cdot q^*_{\ell, m}(j)}{\sqrt{\left(\sum_{m = -\ell}^\ell \abs{q_{\ell, m}(i)}^2\right) \left(\sum_{m = -\ell}^\ell \abs{q_{\ell, m}(j)}^2\right)}}.
\end{equation}

This correlation between two cubes will be a value between -1 and 1, which correspond to anti-ordered to perfectly ordered (with respect to the fourth spherical harmonic), respectively. We then need to choose a cutoff between what we consider ordered and what disordered. For now, we choose every correlation above 0.6 to be an \emph{ordered bond}. In subsection \ref{subsec:order param cutoff} we shall argue why this value was chosen.
Finally, we consider a cube \emph{ordered} if it has at least 4 ordered bonds. We can then group ordered cubes together on the criterium that all neighbouring ordered cubes are considered to be part of the same cluster. We can visualize the crystallization process by making liquid (i.e. not ordered) cubes small, and giving each cluster a different colour. See figure \ref{fig:sample_snapshot}.

\begin{figure}
	\centering
	\begin{subfigure}{0.48\textwidth}
		\centering
		\includegraphics[width=\linewidth]{images/clus1}
		\caption{A sample snapshot of a 1728 cubes in a liquid phase, with some ordered clusters.}
	\end{subfigure}\hfill
	\begin{subfigure}{0.48\textwidth}
		\centering
		\includegraphics[width=\linewidth]{images/clus3}
		\caption{The same system, but at a higher density a large system-spanning cluster has formed.}
	\end{subfigure}
	\caption{Two examples of how our system of interest is visualized. Disordered cubes are drawn small and ordered cubes are drawn at true size, and colored depending on which cluster they belong to.}
	\label{fig:sample_snapshot}
\end{figure}

\subsubsection{Orientational order parameter \texorpdfstring{$i_4$}{i4}}

\subsection{Order parameter cutoff} \label{subsec:order param cutoff}


\vspace{50pt}

\printbibliography[% 
% There are a lot of options for partial bibliographies, but you probably won't use them.
% title = Optional custom title (not recommended)
]

\todo{note for me: don't forget to remove the refs here}

\end{document}







































